<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <title>Aide</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/static/css/help.css}">
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-question-circle me-2"></i> Aide et documentation
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="nav flex-column nav-pills" id="help-tabs" role="tablist" aria-orientation="vertical">
                                    <button class="nav-link active" id="intro-tab" data-bs-toggle="pill" data-bs-target="#intro" type="button" role="tab" aria-controls="intro" aria-selected="true">
                                        Introduction
                                    </button>
                                    <button class="nav-link" id="setup-tab" data-bs-toggle="pill" data-bs-target="#setup" type="button" role="tab" aria-controls="setup" aria-selected="false">
                                        Configuration OBS
                                    </button>
                                    <button class="nav-link" id="usage-tab" data-bs-toggle="pill" data-bs-target="#usage" type="button" role="tab" aria-controls="usage" aria-selected="false">
                                        Utilisation
                                    </button>
                                    <button class="nav-link" id="sync-tab" data-bs-toggle="pill" data-bs-target="#sync" type="button" role="tab" aria-controls="sync" aria-selected="false">
                                        Synchronisation
                                    </button>
                                    <button class="nav-link" id="troubleshooting-tab" data-bs-toggle="pill" data-bs-target="#troubleshooting" type="button" role="tab" aria-controls="troubleshooting" aria-selected="false">
                                        Dépannage
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="tab-content" id="help-tabsContent">
                                    <div class="tab-pane fade show active" id="intro" role="tabpanel" aria-labelledby="intro-tab">
                                        <h4>Introduction</h4>
                                        <p>
                                            OBS Stream Viewer est une application qui permet de capturer, synchroniser et afficher des flux vidéo et audio provenant d'OBS Studio dans une interface web.
                                        </p>
                                        <p>
                                            L'application est conçue pour fonctionner avec OBS Studio et utilise la fonction de diffusion de contenu d'OBS pour recevoir les flux vidéo et audio, et les synchroniser pour un affichage en temps réel.
                                        </p>
                                        <div class="alert alert-info">
                                            <strong>Note:</strong> Cette application nécessite OBS Studio version 31.0.0 ou supérieure avec le plugin WebSocket 5.x activé.
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="setup" role="tabpanel" aria-labelledby="setup-tab">
                                        <h4>Configuration d'OBS Studio</h4>
                                        <p>Pour configurer OBS Studio pour fonctionner avec cette application, suivez ces étapes :</p>
                                        
                                        <h5>1. Activation du serveur WebSocket</h5>
                                        <ul>
                                            <li>Ouvrez OBS Studio</li>
                                            <li>Dans le menu, accédez à <strong>Outils</strong> > <strong>obs-websocket Settings</strong> (ou <strong>Paramètres WebSocket</strong>)</li>
                                            <li>Assurez-vous que l'option <strong>Enable WebSocket server</strong> est cochée</li>
                                            <li>Le port par défaut est <code>4455</code> (pour WebSocket 5.x). Configurez-le pour correspondre au port WebSocket configuré dans cette application (<code th:text="${obsConfig.connection.websocketPort}">4444</code>)</li>
                                            <li>Si vous souhaitez activer l'authentification, définissez un mot de passe et assurez-vous qu'il correspond à celui configuré dans l'application</li>
                                            <li>Cliquez sur <strong>OK</strong> pour enregistrer les paramètres</li>
                                        </ul>
                                        
                                        <div class="alert alert-warning">
                                            <strong>Important :</strong> Cette version de l'application est compatible avec OBS WebSocket 5.x (inclus dans OBS Studio 31.0.0+). Si vous utilisez une version antérieure d'OBS, vous devrez mettre à jour ou utiliser une version antérieure de cette application.
                                        </div>
                                        
                                        <h5>2. Configuration de la sortie vidéo</h5>
                                        <ul>
                                            <li>Dans OBS, accédez aux <strong>Paramètres</strong> > <strong>Sortie</strong></li>
                                            <li>Sélectionnez le mode <strong>Avancé</strong></li>
                                            <li>Configurez une sortie de diffusion avec le protocole <strong>TCP</strong></li>
                                            <li>Adresse du serveur : <code th:text="${obsConfig.connection.host}">localhost</code></li>
                                            <li>Port : <code th:text="${obsConfig.connection.videoPort}">8081</code></li>
                                            <li>Définissez la résolution sur <code th:text="${obsConfig.video.width + 'x' + obsConfig.video.height}">1280x720</code></li>
                                            <li>Définissez la fréquence d'images sur <code th:text="${obsConfig.video.framerate}">30</code> FPS</li>
                                        </ul>
                                        
                                        <h5>3. Configuration de la sortie audio</h5>
                                        <ul>
                                            <li>Toujours dans les paramètres de sortie, configurez une sortie audio séparée</li>
                                            <li>Adresse du serveur : <code th:text="${obsConfig.connection.host}">localhost</code></li>
                                            <li>Port : <code th:text="${obsConfig.connection.audioPort}">8082</code></li>
                                            <li>Taux d'échantillonnage : <code th:text="${obsConfig.audio.sampleRate}">44100</code> Hz</li>
                                            <li>Canaux : <code th:text="${obsConfig.audio.channels}">2</code> (Stéréo)</li>
                                        </ul>
                                    </div>
                                    <div class="tab-pane fade" id="usage" role="tabpanel" aria-labelledby="usage-tab">
                                        <h4>Utilisation de l'application</h4>
                                        
                                        <h5>Démarrage et arrêt du flux</h5>
                                        <p>
                                            Sur la page d'accueil, vous trouverez des boutons pour démarrer et arrêter la capture du flux :
                                        </p>
                                        <ul>
                                            <li>Cliquez sur <strong>Démarrer</strong> pour commencer la capture du flux depuis OBS</li>
                                            <li>Cliquez sur <strong>Arrêter</strong> pour interrompre la capture</li>
                                        </ul>
                                        <p>
                                            L'application se connectera automatiquement à OBS via WebSocket 5.x et démarrera le streaming dans OBS si nécessaire.
                                        </p>
                                        
                                        <h5>Contrôle du volume</h5>
                                        <p>
                                            Vous pouvez contrôler le volume audio en cochant ou décochant l'option <strong>Couper le son</strong>.
                                        </p>
                                        
                                        <h5>Personnalisation des paramètres</h5>
                                        <p>
                                            Pour personnaliser les paramètres de l'application, visitez la page <strong>Paramètres</strong> où vous pourrez modifier :
                                        </p>
                                        <ul>
                                            <li>Les paramètres de connexion à OBS</li>
                                            <li>Les paramètres vidéo (résolution, fréquence d'images)</li>
                                            <li>Les paramètres audio (taux d'échantillonnage, canaux)</li>
                                            <li>Les paramètres de synchronisation par défaut</li>
                                        </ul>
                                    </div>
                                    <div class="tab-pane fade" id="sync" role="tabpanel" aria-labelledby="sync-tab">
                                        <h4>Synchronisation audio/vidéo</h4>
                                        
                                        <p>
                                            La synchronisation entre l'audio et la vidéo est cruciale pour une expérience de visualisation de qualité. Cette application offre des outils pour ajuster cette synchronisation.
                                        </p>
                                        
                                        <h5>Ajustement du décalage</h5>
                                        <p>
                                            Sur la page d'accueil, vous trouverez un curseur <strong>Décalage de synchronisation</strong> qui vous permet d'ajuster le décalage entre l'audio et la vidéo :
                                        </p>
                                        <ul>
                                            <li><strong>Valeur positive</strong> : l'audio est retardé par rapport à la vidéo</li>
                                            <li><strong>Valeur négative</strong> : la vidéo est retardée par rapport à l'audio</li>
                                            <li><strong>Zéro</strong> : aucun décalage appliqué</li>
                                        </ul>
                                        
                                        <h5>Comment tester la synchronisation</h5>
                                        <p>
                                            Pour vérifier si la synchronisation est correcte, vous pouvez :
                                        </p>
                                        <ol>
                                            <li>Afficher dans OBS une source qui produit des sons synchronisés avec des événements visuels</li>
                                            <li>Observer le flux dans OBS Stream Viewer</li>
                                            <li>Ajuster le curseur de décalage jusqu'à ce que le son et l'image soient parfaitement synchronisés</li>
                                        </ol>
                                        
                                        <div class="alert alert-warning">
                                            <strong>Conseil :</strong> Les changements de décalage prennent effet immédiatement, mais peuvent nécessiter quelques secondes pour être visibles dans le flux en raison de la mise en mémoire tampon.
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="troubleshooting" role="tabpanel" aria-labelledby="troubleshooting-tab">
                                        <h4>Dépannage</h4>
                                        
                                        <h5>Problèmes courants et solutions</h5>
                                        
                                        <div class="accordion" id="troubleshootingAccordion">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="headingOne">
                                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                        Impossible de se connecter à OBS
                                                    </button>
                                                </h2>
                                                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#troubleshootingAccordion">
                                                    <div class="accordion-body">
                                                        <ul>
                                                            <li>Vérifiez qu'OBS Studio est en cours d'exécution et qu'il s'agit de la version 31.0.0 ou supérieure</li>
                                                            <li>Assurez-vous que le plugin WebSocket 5.x est activé dans OBS</li>
                                                            <li>Vérifiez que le port WebSocket configuré dans l'application (<code th:text="${obsConfig.connection.websocketPort}">4444</code>) correspond au port configuré dans OBS (généralement 4455 pour WebSocket 5.x)</li>
                                                            <li>Si vous avez activé l'authentification, vérifiez que le mot de passe est correct</li>
                                                            <li>Vérifiez que votre pare-feu ne bloque pas les connexions aux ports utilisés</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="headingTwo">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                        Pas de vidéo ou d'audio
                                                    </button>
                                                </h2>
                                                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#troubleshootingAccordion">
                                                    <div class="accordion-body">
                                                        <ul>
                                                            <li>Vérifiez que la sortie vidéo et audio est configurée correctement dans OBS</li>
                                                            <li>Assurez-vous que les ports configurés pour la vidéo et l'audio sont corrects</li>
                                                            <li>Vérifiez qu'OBS est en mode "Studio" et que vous avez cliqué sur "Démarrer la diffusion"</li>
                                                            <li>Vérifiez que le son n'est pas coupé dans l'application</li>
                                                            <li>Essayez de rafraîchir la page</li>
                                                            <li>Vérifiez que la connexion WebSocket est établie (page Paramètres > État de la connexion)</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="headingThree">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                        Problèmes de synchronisation
                                                    </button>
                                                </h2>
                                                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#troubleshootingAccordion">
                                                    <div class="accordion-body">
                                                        <ul>
                                                            <li>Ajustez le curseur de décalage de synchronisation pour corriger les problèmes</li>
                                                            <li>Si le curseur n'a pas d'effet, vérifiez si les flux vidéo et audio sont correctement reçus</li>
                                                            <li>Essayez de réduire la résolution ou la fréquence d'images si vous rencontrez des problèmes de performance</li>
                                                            <li>Vérifiez la charge CPU sur votre machine et sur celle exécutant OBS</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="headingFour">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                                        Problèmes avec WebSocket 5.x
                                                    </button>
                                                </h2>
                                                <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#troubleshootingAccordion">
                                                    <div class="accordion-body">
                                                        <ul>
                                                            <li>Cette version de l'application est spécifiquement conçue pour OBS Studio 31.0.0+ avec WebSocket 5.x</li>
                                                            <li>Vérifiez votre version d'OBS Studio et assurez-vous qu'elle est compatible</li>
                                                            <li>Le port par défaut pour WebSocket 5.x est 4455, assurez-vous que votre configuration est correcte</li>
                                                            <li>Si vous utilisez une version antérieure d'OBS, vous devrez mettre à jour ou utiliser une version compatible</li>
                                                            <li>Consultez la <a href="https://github.com/obsproject/obs-websocket/blob/master/docs/generated/protocol.md" target="_blank">documentation officielle de WebSocket 5.x</a> pour plus d'informations</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <h5 class="mt-4">Contact et support</h5>
                                        <p>
                                            Si vous rencontrez des problèmes qui ne sont pas résolus par les solutions ci-dessus, vous pouvez :
                                        </p>
                                        <ul>
                                            <li>Consulter la <a href="https://github.com/rbaudu/obs-stream-viewer" target="_blank">documentation GitHub</a> du projet</li>
                                            <li>Signaler un problème sur le <a href="https://github.com/rbaudu/obs-stream-viewer/issues" target="_blank">suivi des problèmes</a></li>
                                            <li>Contacter directement le développeur via GitHub</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <th:block layout:fragment="js">
        <script th:src="@{/static/js/help.js}"></script>
    </th:block>
</body>
</html>
